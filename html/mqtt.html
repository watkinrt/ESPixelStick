<div id="mqtt">
    <legend class="esps-legend">MQTT Configuration</legend>
    <div class="form-group has-feedback" id="fg_mqtt">
        <fieldset id="fs_mqtt">
            <div class="form-group has-feedback">
                <label class="control-label col-sm-2" for="ip">Broker IP</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="ip" name="ip" minlength="7" maxlength="15" pattern='\b((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}\b' value="0.0.0.0" title="MQTT Broker IP.">
                </div>

                <label class="control-label col-sm-2" for="port">Broker Port</label>
                <div class="col-sm-2">
                    <input type="text" class="form-control" id="port" name="port" minlength="1" maxlength="5" pattern='^([0-9]{1,4}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$' value="0" title="MQTT Broker Port.">
                </div>
            </div>

            <div class="form-group has-feedback">
                <label class="control-label col-sm-2" for="user">User</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="user" name="user" minlength="1" maxlength="20" title="MQTT Username (optional).">
                </div>

                <label class="control-label col-sm-2" for="password">Password</label>
                <div class="col-sm-4">
                    <input type="password" class="form-control" id="password" name="password" minlength="1" maxlength="20" title="MQTT Password (optional).">
                </div>
            </div>

            <div class="form-group has-feedback">
                <label class="control-label col-sm-2" for="topic">Status Topic</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="topic" name="topic" maxlength="32" title="MQTT Status Topic. Control topic will be appended with /set." onchange="UpdateTopicSet(this)">
                </div>

                <label class="control-label col-sm-2" for="topicset">Set Topic</label>
                <div class="col-sm-4 topicset">
                    <input type="text" class="form-control topicset" id="topicset" name="topicset" maxlength="32" title="MQTT Set Topic." readonly="true">
                </div>
            </div>

            <div class="form-group has-feedback">
                <label class="control-label col-sm-2" for="haprefix">Home Assistant Prefix</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="haprefix" name="haprefix" maxlength="32" title="Prefix used for Home Assistant Discovery">
                </div>

                <label class="control-label col-sm-2" for="lwt">LWT Payload</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="lwt" name="lwt" maxlength="32" title="Last Will \& Testiment">
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <div class="checkbox"><label><input type="checkbox" id="hadisco" name="hadisco" title="Enables auto-discovery by Home Assistant."> Home Assistant Discovery</label></div>
                </div>
                <div class="col-sm-offset-2 col-sm-10">
                    <div class="checkbox"><label><input type="checkbox" id="clean" name="clean"> Clean Session</label></div>
                </div>
            </div>
        </fieldset>
    </div>
</div>

<script>
    function UpdateTopicSet(ThisObject)
    {
        $(ThisObject.parentNode.parentNode.children).each(function ()
        {
            if ($(this).hasClass("topicset"))
            {
                this.children[0].value = ThisObject.value + "/set";
            }
        });
    } // UpdateTopicSet
</script>

